"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _isotropicMixinPrototypeChain=require("isotropic-mixin-prototype-chain"),_isotropicError=_interopRequireDefault(require("isotropic-error")),_isotropicMake=_interopRequireDefault(require("isotropic-make")),_isotropicPrototypeChain=_interopRequireDefault(require("isotropic-prototype-chain"));function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}var _default=(0,_isotropicMake.default)({_init({propertyChainsIncludeMixins:a=!0,propertyChainsPropertyName:b="_propertyChains"}={}){const c=new Set;for(const d of a?(0,_isotropicMixinPrototypeChain.mixinPrototypeChainFromInstanceObject)(this):(0,_isotropicPrototypeChain.default)(this)){if(d===Object.prototype)break;if(Reflect.apply(Object.prototype.hasOwnProperty,d,[b]))for(const a of d[b])c.add(a)}if(c.size){const b=this._initPropertyChains({includeMixins:a,propertyNameSet:c});Object.keys(b).forEach(a=>{const c=b[a];let d;c.objects.forEach(b=>{const e=c.propertyValueByObjectMap.get(b);if(d&&!Reflect.setPrototypeOf(d,e))throw(0,_isotropicError.default)({details:{propertyName:a},message:"Instance property chain could not be created"});d=e})})}return this},_initPropertyChains({includeMixins:a,propertyChainsByPropertyName:c={},propertyNameSet:b,startObject:d=this}){const e=d!==this;for(const f of(0,_isotropicPrototypeChain.default)(d)){if(f===Object.prototype)break;for(const a of b)if(Reflect.apply(Object.prototype.hasOwnProperty,f,[a])){const b=f[a];switch(typeof b){case"function":case"object":break;default:continue;}let d=c[a];d||(d={objects:[],propertyValueByObjectMap:new Map},c[a]=d),d.propertyValueByObjectMap.has(f)&&d.objects.splice(d.objects.indexOf(f),1),d.objects.push(f),d.propertyValueByObjectMap.set(f,e?{...b}:b)}if(a){const d=f.constructor&&f.constructor.mixins;if(Array.isArray(d))for(let e=d.length-1;0<=e;e-=1)this._initPropertyChains({includeMixins:a,propertyChainsByPropertyName:c,propertyNameSet:b,startObject:d[e].prototype})}}return c}},{_init({propertyChainsIncludeMixins:a=!0,propertyChainsPropertyName:b="_propertyChains"}={}){const c=new Set;for(const d of a?(0,_isotropicMixinPrototypeChain.mixinPrototypeChainFromStaticObject)(this):(0,_isotropicPrototypeChain.default)(this)){if(d===Object)break;if(Reflect.apply(Object.prototype.hasOwnProperty,d,[b]))for(const a of d[b])c.add(a)}if(c.size){const b=this._initPropertyChains({includeMixins:a,propertyNameSet:c});Object.keys(b).forEach(a=>{const c=b[a];let d;c.objects.forEach(b=>{const e=c.propertyValueByObjectMap.get(b);if(d&&!Reflect.setPrototypeOf(d,e))throw(0,_isotropicError.default)({details:{propertyName:a},message:"Static property chain could not be created"});d=e})})}return this},_initPropertyChains({includeMixins:a,propertyChainsByPropertyName:c={},propertyNameSet:b,startObject:d=this}){const e=d!==this;for(const f of(0,_isotropicPrototypeChain.default)(d)){if(f===Object)break;for(const a of b)if(Reflect.apply(Object.prototype.hasOwnProperty,f,[a])){const b=f[a];switch(typeof b){case"function":case"object":break;default:continue;}let d=c[a];d||(d={objects:[],propertyValueByObjectMap:new Map},c[a]=d),d.propertyValueByObjectMap.has(f)&&d.objects.splice(d.objects.indexOf(f),1),d.objects.push(f),d.propertyValueByObjectMap.set(f,e?{...b}:b)}if(a&&Array.isArray(f.mixins))for(let d=f.mixins.length-1;0<=d;d-=1)this._initPropertyChains({includeMixins:a,propertyChainsByPropertyName:c,propertyNameSet:b,startObject:f.mixins[d]})}return c}});exports.default=_default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL2pzL3Byb3BlcnR5LWNoYWluZXIuanMiXSwibmFtZXMiOlsiX2luaXQiLCJwcm9wZXJ0eUNoYWluc0luY2x1ZGVNaXhpbnMiLCJwcm9wZXJ0eUNoYWluc1Byb3BlcnR5TmFtZSIsInByb3BlcnR5TmFtZVNldCIsIlNldCIsIm9iamVjdCIsIk9iamVjdCIsInByb3RvdHlwZSIsIlJlZmxlY3QiLCJhcHBseSIsImhhc093blByb3BlcnR5IiwicHJvcGVydHlOYW1lIiwiYWRkIiwic2l6ZSIsInByb3BlcnR5Q2hhaW5zQnlQcm9wZXJ0eU5hbWUiLCJfaW5pdFByb3BlcnR5Q2hhaW5zIiwiaW5jbHVkZU1peGlucyIsImtleXMiLCJmb3JFYWNoIiwicHJvcGVydHlDaGFpbiIsInByZXZpb3VzUHJvcGVydHlWYWx1ZSIsIm9iamVjdHMiLCJwcm9wZXJ0eVZhbHVlIiwicHJvcGVydHlWYWx1ZUJ5T2JqZWN0TWFwIiwiZ2V0Iiwic2V0UHJvdG90eXBlT2YiLCJkZXRhaWxzIiwibWVzc2FnZSIsInN0YXJ0T2JqZWN0IiwiaXNNaXhpbiIsIk1hcCIsImhhcyIsInNwbGljZSIsImluZGV4T2YiLCJwdXNoIiwic2V0IiwibWl4aW5zIiwiY29uc3RydWN0b3IiLCJBcnJheSIsImlzQXJyYXkiLCJtaXhpbkluZGV4IiwibGVuZ3RoIl0sIm1hcHBpbmdzIjoidWRBUWUsMkJBQU0sQ0FDakJBLEtBQUssQ0FBRSxDQUNIQywyQkFBMkIsQ0FBM0JBLENBQTJCLEdBRHhCLENBRUhDLDBCQUEwQixDQUExQkEsQ0FBMEIsQ0FBRyxpQkFGMUIsRUFHSCxFQUhDLENBR0csQ0FDSixLQUFNQyxDQUFBQSxDQUFlLENBQUcsR0FBSUMsQ0FBQUEsR0FBNUIsQ0FFQSxJQUNJLEtBQU1DLENBQUFBLENBRFYsR0FDb0JKLENBQUFBLENBQTJCLENBQ3ZDLHdFQUF1QyxJQUF2QyxDQUR1QyxDQUV2QyxxQ0FBZ0IsSUFBaEIsQ0FIUixDQUlFLENBQ0UsR0FBSUksQ0FBTSxHQUFLQyxNQUFNLENB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LENBQUNFLE9BQWQsQ0FBc0JhLElBQXRCLENBQTJCN0IsQ0FBM0IsQ0F6QkEsQ0EwQkFjLENBQWEsQ0FBQ0ksd0JBQWQsQ0FBdUNZLEdBQXZDLENBQ0k5QixDQURKLENBRUl3QixDQUFPLENBQ0gsQ0FDSSxHQUFHUCxDQURQLENBREcsQ0FJSEEsQ0FOUixDQVFILENBR0wsR0FBSU4sQ0FBYSxFQUFJc0IsS0FBSyxDQUFDQyxPQUFOLENBQWNsQyxDQUFNLENBQUMrQixNQUFyQixDQUFyQixDQUNJLElBQUssR0FBSUksQ0FBQUEsQ0FBVSxDQUFHbkMsQ0FBTSxDQUFDK0IsTUFBUCxDQUFjSyxNQUFkLENBQXVCLENBQTdDLENBQThELENBQWQsRUFBQUQsQ0FBaEQsQ0FBaUVBLENBQVUsRUFBSSxDQUEvRSxDQUNJLEtBQUt6QixtQkFBTCxDQUF5QixDQUNyQkMsYUFBYSxDQUFiQSxDQURxQixDQUVyQkYsNEJBQTRCLENBQTVCQSxDQUZxQixDQUdyQlgsZUFBZSxDQUFmQSxDQUhxQixDQUlyQnlCLFdBQVcsQ0FBRXZCLENBQU0sQ0FBQytCLE1BQVAsQ0FBY0ksQ0FBZCxDQUpRLENBQXpCLENBUVgsQ0FFRCxNQUFPMUIsQ0FBQUEsQ0FDVixDQXpIRixDQTlIWSxDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgICBtaXhpblByb3RvdHlwZUNoYWluRnJvbUluc3RhbmNlT2JqZWN0IGFzIF9taXhpblByb3RvdHlwZUNoYWluRnJvbUluc3RhbmNlT2JqZWN0LFxuICAgIG1peGluUHJvdG90eXBlQ2hhaW5Gcm9tU3RhdGljT2JqZWN0IGFzIF9taXhpblByb3RvdHlwZUNoYWluRnJvbVN0YXRpY09iamVjdFxufSBmcm9tICdpc290cm9waWMtbWl4aW4tcHJvdG90eXBlLWNoYWluJztcbmltcG9ydCBfRXJyb3IgZnJvbSAnaXNvdHJvcGljLWVycm9yJztcbmltcG9ydCBfbWFrZSBmcm9tICdpc290cm9waWMtbWFrZSc7XG5pbXBvcnQgX3Byb3RvdHlwZUNoYWluIGZyb20gJ2lzb3Ryb3BpYy1wcm90b3R5cGUtY2hhaW4nO1xuXG5leHBvcnQgZGVmYXVsdCBfbWFrZSh7XG4gICAgX2luaXQgKHtcbiAgICAgICAgcHJvcGVydHlDaGFpbnNJbmNsdWRlTWl4aW5zID0gdHJ1ZSxcbiAgICAgICAgcHJvcGVydHlDaGFpbnNQcm9wZXJ0eU5hbWUgPSAnX3Byb3BlcnR5Q2hhaW5zJ1xuICAgIH0gPSB7fSkge1xuICAgICAgICBjb25zdCBwcm9wZXJ0eU5hbWVTZXQgPSBuZXcgU2V0KCk7XG5cbiAgICAgICAgZm9yIChcbiAgICAgICAgICAgIGNvbnN0IG9iamVjdCBvZiBwcm9wZXJ0eUNoYWluc0luY2x1ZGVNaXhpbnMgP1xuICAgICAgICAgICAgICAgIF9taXhpblByb3RvdHlwZUNoYWluRnJvbUluc3RhbmNlT2JqZWN0KHRoaXMpIDpcbiAgICAgICAgICAgICAgICBfcHJvdG90eXBlQ2hhaW4odGhpcylcbiAgICAgICAgKSB7XG4gICAgICAgICAgICBpZiAob2JqZWN0ID09PSBPYmplY3QucHJvdG90eXBlKSB7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChSZWZsZWN0LmFwcGx5KE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHksIG9iamVjdCwgW1xuICAgICAgICAgICAgICAgIHByb3BlcnR5Q2hhaW5zUHJvcGVydHlOYW1lXG4gICAgICAgICAgICBdKSkge1xuICAgICAgICAgICAgICAgIGZvciAoY29uc3QgcHJvcGVydHlOYW1lIG9mIG9iamVjdFtwcm9wZXJ0eUNoYWluc1Byb3BlcnR5TmFtZV0pIHtcbiAgICAgICAgICAgICAgICAgICAgcHJvcGVydHlOYW1lU2V0LmFkZChwcm9wZXJ0eU5hbWUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChwcm9wZXJ0eU5hbWVTZXQuc2l6ZSkge1xuICAgICAgICAgICAgY29uc3QgcHJvcGVydHlDaGFpbnNCeVByb3BlcnR5TmFtZSA9IHRoaXMuX2luaXRQcm9wZXJ0eUNoYWlucyh7XG4gICAgICAgICAgICAgICAgaW5jbHVkZU1peGluczogcHJvcGVydHlDaGFpbnNJbmNsdWRlTWl4aW5zLFxuICAgICAgICAgICAgICAgIHByb3BlcnR5TmFtZVNldFxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIE9iamVjdC5rZXlzKHByb3BlcnR5Q2hhaW5zQnlQcm9wZXJ0eU5hbWUpLmZvckVhY2gocHJvcGVydHlOYW1lID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBwcm9wZXJ0eUNoYWluID0gcHJvcGVydHlDaGFpbnNCeVByb3BlcnR5TmFtZVtwcm9wZXJ0eU5hbWVdO1xuXG4gICAgICAgICAgICAgICAgbGV0IHByZXZpb3VzUHJvcGVydHlWYWx1ZTtcblxuICAgICAgICAgICAgICAgIHByb3BlcnR5Q2hhaW4ub2JqZWN0cy5mb3JFYWNoKG9iamVjdCA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHByb3BlcnR5VmFsdWUgPSBwcm9wZXJ0eUNoYWluLnByb3BlcnR5VmFsdWVCeU9iamVjdE1hcC5nZXQob2JqZWN0KTtcblxuICAgICAgICAgICAgICAgICAgICBpZiAocHJldmlvdXNQcm9wZXJ0eVZhbHVlICYmICFSZWZsZWN0LnNldFByb3RvdHlwZU9mKHByZXZpb3VzUHJvcGVydHlWYWx1ZSwgcHJvcGVydHlWYWx1ZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IF9FcnJvcih7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGV0YWlsczoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9wZXJ0eU5hbWVcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6ICdJbnN0YW5jZSBwcm9wZXJ0eSBjaGFpbiBjb3VsZCBub3QgYmUgY3JlYXRlZCdcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgcHJldmlvdXNQcm9wZXJ0eVZhbHVlID0gcHJvcGVydHlWYWx1ZTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfSxcbiAgICBfaW5pdFByb3BlcnR5Q2hhaW5zICh7XG4gICAgICAgIGluY2x1ZGVNaXhpbnMsXG4gICAgICAgIHByb3BlcnR5Q2hhaW5zQnlQcm9wZXJ0eU5hbWUgPSB7fSxcbiAgICAgICAgcHJvcGVydHlOYW1lU2V0LFxuICAgICAgICBzdGFydE9iamVjdCA9IHRoaXNcbiAgICB9KSB7XG4gICAgICAgIGNvbnN0IGlzTWl4aW4gPSBzdGFydE9iamVjdCAhPT0gdGhpcztcblxuICAgICAgICBmb3IgKGNvbnN0IG9iamVjdCBvZiBfcHJvdG90eXBlQ2hhaW4oc3RhcnRPYmplY3QpKSB7XG4gICAgICAgICAgICBpZiAob2JqZWN0ID09PSBPYmplY3QucHJvdG90eXBlKSB7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGZvciAoY29uc3QgcHJvcGVydHlOYW1lIG9mIHByb3BlcnR5TmFtZVNldCkge1xuICAgICAgICAgICAgICAgIGlmIChSZWZsZWN0LmFwcGx5KE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHksIG9iamVjdCwgW1xuICAgICAgICAgICAgICAgICAgICBwcm9wZXJ0eU5hbWVcbiAgICAgICAgICAgICAgICBdKSkge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBwcm9wZXJ0eVZhbHVlID0gb2JqZWN0W3Byb3BlcnR5TmFtZV07XG5cbiAgICAgICAgICAgICAgICAgICAgc3dpdGNoICh0eXBlb2YgcHJvcGVydHlWYWx1ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnZnVuY3Rpb24nOlxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnb2JqZWN0JzpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBsZXQgcHJvcGVydHlDaGFpbiA9IHByb3BlcnR5Q2hhaW5zQnlQcm9wZXJ0eU5hbWVbcHJvcGVydHlOYW1lXTtcblxuICAgICAgICAgICAgICAgICAgICBpZiAoIXByb3BlcnR5Q2hhaW4pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHByb3BlcnR5Q2hhaW4gPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb2JqZWN0czogW10sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvcGVydHlWYWx1ZUJ5T2JqZWN0TWFwOiBuZXcgTWFwKClcbiAgICAgICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgICAgICAgICBwcm9wZXJ0eUNoYWluc0J5UHJvcGVydHlOYW1lW3Byb3BlcnR5TmFtZV0gPSBwcm9wZXJ0eUNoYWluO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKHByb3BlcnR5Q2hhaW4ucHJvcGVydHlWYWx1ZUJ5T2JqZWN0TWFwLmhhcyhvYmplY3QpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBwcm9wZXJ0eUNoYWluLm9iamVjdHMuc3BsaWNlKHByb3BlcnR5Q2hhaW4ub2JqZWN0cy5pbmRleE9mKG9iamVjdCksIDEpO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgcHJvcGVydHlDaGFpbi5vYmplY3RzLnB1c2gob2JqZWN0KTtcbiAgICAgICAgICAgICAgICAgICAgcHJvcGVydHlDaGFpbi5wcm9wZXJ0eVZhbHVlQnlPYmplY3RNYXAuc2V0KFxuICAgICAgICAgICAgICAgICAgICAgICAgb2JqZWN0LFxuICAgICAgICAgICAgICAgICAgICAgICAgaXNNaXhpbiA/XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuLi5wcm9wZXJ0eVZhbHVlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSA6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvcGVydHlWYWx1ZVxuICAgICAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKGluY2x1ZGVNaXhpbnMpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBtaXhpbnMgPSBvYmplY3QuY29uc3RydWN0b3IgJiYgb2JqZWN0LmNvbnN0cnVjdG9yLm1peGlucztcblxuICAgICAgICAgICAgICAgIGlmIChBcnJheS5pc0FycmF5KG1peGlucykpIHtcbiAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgbWl4aW5JbmRleCA9IG1peGlucy5sZW5ndGggLSAxOyBtaXhpbkluZGV4ID49IDA7IG1peGluSW5kZXggLT0gMSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5faW5pdFByb3BlcnR5Q2hhaW5zKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbmNsdWRlTWl4aW5zLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb3BlcnR5Q2hhaW5zQnlQcm9wZXJ0eU5hbWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvcGVydHlOYW1lU2V0LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXJ0T2JqZWN0OiBtaXhpbnNbbWl4aW5JbmRleF0ucHJvdG90eXBlXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBwcm9wZXJ0eUNoYWluc0J5UHJvcGVydHlOYW1lO1xuICAgIH1cbn0sIHtcbiAgICBfaW5pdCAoe1xuICAgICAgICBwcm9wZXJ0eUNoYWluc0luY2x1ZGVNaXhpbnMgPSB0cnVlLFxuICAgICAgICBwcm9wZXJ0eUNoYWluc1Byb3BlcnR5TmFtZSA9ICdfcHJvcGVydHlDaGFpbnMnXG4gICAgfSA9IHt9KSB7XG4gICAgICAgIGNvbnN0IHByb3BlcnR5TmFtZVNldCA9IG5ldyBTZXQoKTtcblxuICAgICAgICBmb3IgKFxuICAgICAgICAgICAgY29uc3Qgb2JqZWN0IG9mIHByb3BlcnR5Q2hhaW5zSW5jbHVkZU1peGlucyA/XG4gICAgICAgICAgICAgICAgX21peGluUHJvdG90eXBlQ2hhaW5Gcm9tU3RhdGljT2JqZWN0KHRoaXMpIDpcbiAgICAgICAgICAgICAgICBfcHJvdG90eXBlQ2hhaW4odGhpcylcbiAgICAgICAgKSB7XG4gICAgICAgICAgICBpZiAob2JqZWN0ID09PSBPYmplY3QpIHtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKFJlZmxlY3QuYXBwbHkoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eSwgb2JqZWN0LCBbXG4gICAgICAgICAgICAgICAgcHJvcGVydHlDaGFpbnNQcm9wZXJ0eU5hbWVcbiAgICAgICAgICAgIF0pKSB7XG4gICAgICAgICAgICAgICAgZm9yIChjb25zdCBwcm9wZXJ0eU5hbWUgb2Ygb2JqZWN0W3Byb3BlcnR5Q2hhaW5zUHJvcGVydHlOYW1lXSkge1xuICAgICAgICAgICAgICAgICAgICBwcm9wZXJ0eU5hbWVTZXQuYWRkKHByb3BlcnR5TmFtZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHByb3BlcnR5TmFtZVNldC5zaXplKSB7XG4gICAgICAgICAgICBjb25zdCBwcm9wZXJ0eUNoYWluc0J5UHJvcGVydHlOYW1lID0gdGhpcy5faW5pdFByb3BlcnR5Q2hhaW5zKHtcbiAgICAgICAgICAgICAgICBpbmNsdWRlTWl4aW5zOiBwcm9wZXJ0eUNoYWluc0luY2x1ZGVNaXhpbnMsXG4gICAgICAgICAgICAgICAgcHJvcGVydHlOYW1lU2V0XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgT2JqZWN0LmtleXMocHJvcGVydHlDaGFpbnNCeVByb3BlcnR5TmFtZSkuZm9yRWFjaChwcm9wZXJ0eU5hbWUgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IHByb3BlcnR5Q2hhaW4gPSBwcm9wZXJ0eUNoYWluc0J5UHJvcGVydHlOYW1lW3Byb3BlcnR5TmFtZV07XG5cbiAgICAgICAgICAgICAgICBsZXQgcHJldmlvdXNQcm9wZXJ0eVZhbHVlO1xuXG4gICAgICAgICAgICAgICAgcHJvcGVydHlDaGFpbi5vYmplY3RzLmZvckVhY2gob2JqZWN0ID0+IHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgcHJvcGVydHlWYWx1ZSA9IHByb3BlcnR5Q2hhaW4ucHJvcGVydHlWYWx1ZUJ5T2JqZWN0TWFwLmdldChvYmplY3QpO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmIChwcmV2aW91c1Byb3BlcnR5VmFsdWUgJiYgIVJlZmxlY3Quc2V0UHJvdG90eXBlT2YocHJldmlvdXNQcm9wZXJ0eVZhbHVlLCBwcm9wZXJ0eVZhbHVlKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgX0Vycm9yKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXRhaWxzOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb3BlcnR5TmFtZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogJ1N0YXRpYyBwcm9wZXJ0eSBjaGFpbiBjb3VsZCBub3QgYmUgY3JlYXRlZCdcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgcHJldmlvdXNQcm9wZXJ0eVZhbHVlID0gcHJvcGVydHlWYWx1ZTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfSxcbiAgICBfaW5pdFByb3BlcnR5Q2hhaW5zICh7XG4gICAgICAgIGluY2x1ZGVNaXhpbnMsXG4gICAgICAgIHByb3BlcnR5Q2hhaW5zQnlQcm9wZXJ0eU5hbWUgPSB7fSxcbiAgICAgICAgcHJvcGVydHlOYW1lU2V0LFxuICAgICAgICBzdGFydE9iamVjdCA9IHRoaXNcbiAgICB9KSB7XG4gICAgICAgIGNvbnN0IGlzTWl4aW4gPSBzdGFydE9iamVjdCAhPT0gdGhpcztcblxuICAgICAgICBmb3IgKGNvbnN0IG9iamVjdCBvZiBfcHJvdG90eXBlQ2hhaW4oc3RhcnRPYmplY3QpKSB7XG4gICAgICAgICAgICBpZiAob2JqZWN0ID09PSBPYmplY3QpIHtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZm9yIChjb25zdCBwcm9wZXJ0eU5hbWUgb2YgcHJvcGVydHlOYW1lU2V0KSB7XG4gICAgICAgICAgICAgICAgaWYgKFJlZmxlY3QuYXBwbHkoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eSwgb2JqZWN0LCBbXG4gICAgICAgICAgICAgICAgICAgIHByb3BlcnR5TmFtZVxuICAgICAgICAgICAgICAgIF0pKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHByb3BlcnR5VmFsdWUgPSBvYmplY3RbcHJvcGVydHlOYW1lXTtcblxuICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKHR5cGVvZiBwcm9wZXJ0eVZhbHVlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdmdW5jdGlvbic6XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdvYmplY3QnOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIGxldCBwcm9wZXJ0eUNoYWluID0gcHJvcGVydHlDaGFpbnNCeVByb3BlcnR5TmFtZVtwcm9wZXJ0eU5hbWVdO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmICghcHJvcGVydHlDaGFpbikge1xuICAgICAgICAgICAgICAgICAgICAgICAgcHJvcGVydHlDaGFpbiA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYmplY3RzOiBbXSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9wZXJ0eVZhbHVlQnlPYmplY3RNYXA6IG5ldyBNYXAoKVxuICAgICAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHByb3BlcnR5Q2hhaW5zQnlQcm9wZXJ0eU5hbWVbcHJvcGVydHlOYW1lXSA9IHByb3BlcnR5Q2hhaW47XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBpZiAocHJvcGVydHlDaGFpbi5wcm9wZXJ0eVZhbHVlQnlPYmplY3RNYXAuaGFzKG9iamVjdCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHByb3BlcnR5Q2hhaW4ub2JqZWN0cy5zcGxpY2UocHJvcGVydHlDaGFpbi5vYmplY3RzLmluZGV4T2Yob2JqZWN0KSwgMSk7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBwcm9wZXJ0eUNoYWluLm9iamVjdHMucHVzaChvYmplY3QpO1xuICAgICAgICAgICAgICAgICAgICBwcm9wZXJ0eUNoYWluLnByb3BlcnR5VmFsdWVCeU9iamVjdE1hcC5zZXQoXG4gICAgICAgICAgICAgICAgICAgICAgICBvYmplY3QsXG4gICAgICAgICAgICAgICAgICAgICAgICBpc01peGluID9cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC4uLnByb3BlcnR5VmFsdWVcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IDpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9wZXJ0eVZhbHVlXG4gICAgICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoaW5jbHVkZU1peGlucyAmJiBBcnJheS5pc0FycmF5KG9iamVjdC5taXhpbnMpKSB7XG4gICAgICAgICAgICAgICAgZm9yIChsZXQgbWl4aW5JbmRleCA9IG9iamVjdC5taXhpbnMubGVuZ3RoIC0gMTsgbWl4aW5JbmRleCA+PSAwOyBtaXhpbkluZGV4IC09IDEpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5faW5pdFByb3BlcnR5Q2hhaW5zKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGluY2x1ZGVNaXhpbnMsXG4gICAgICAgICAgICAgICAgICAgICAgICBwcm9wZXJ0eUNoYWluc0J5UHJvcGVydHlOYW1lLFxuICAgICAgICAgICAgICAgICAgICAgICAgcHJvcGVydHlOYW1lU2V0LFxuICAgICAgICAgICAgICAgICAgICAgICAgc3RhcnRPYmplY3Q6IG9iamVjdC5taXhpbnNbbWl4aW5JbmRleF1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHByb3BlcnR5Q2hhaW5zQnlQcm9wZXJ0eU5hbWU7XG4gICAgfVxufSk7XG4iXX0=